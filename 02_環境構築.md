## プロジェクトの準備

### 1 前提条件

必要なツールの確認です。

1. Node.jsがインストールされていること
   - バージョン確認: ターミナルで `node -v` を実行
   - インストールされていない場合は、[Node.js公式サイト](https://nodejs.org/)からダウンロード

2. npmがインストールされていること（Node.jsと一緒にインストールされます）
   - バージョン確認: `npm -v` を実行

3. 好みのコードエディタ（Visual Studio Code推奨）

### 2 プロジェクトの作成

まずは、新しいプロジェクトを作成します

```bash
# プロジェクトディレクトリの作成
mkdir todo-api-tdd
cd todo-api-tdd

# package.jsonの初期化（すべてEnterで OK）
npm init -y

# 必要なパッケージのインストール
npm install --save-dev typescript ts-jest @types/jest jest @types/node
npm install --save express @types/express
```
インストールが完了したら、`package.json`に必要なパッケージが追加されていることを確認しましょう
```json
{
  "devDependencies": {
    "@types/jest": "^29.5.12",
    "jest": "^29.7.0",
    "ts-jest": "^29.1.2",
    "typescript": "^5.3.3"
  }
}
```

### 3 TypeScript設定
最新のNode.js環境に合わせた設定を行います。

```bash
# TypeScript設定ファイルの生成
npx tsc --init
```

`tsconfig.json`を以下のように設定します

```json
{
  "compilerOptions": {
    "target": "es2020",
    "module": "commonjs",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "**/*.test.ts"]
}
```
**ポイント**
- `target`: モダンなJavaScript機能を使用可能に
- `sourceMap`: デバッグを容易にする
- `rootDir`と`include`: ソースコードの配置場所を明確に
- `include` , `exclude`: 不要なファイルをコンパイルしないことで、ビルド時間を短縮
- `exclude`: テストファイルをビルド対象から除外

### 4 Jest設定
```bash
# Jest設定ファイルの生成
npx ts-jest config:init
```

Jest用の設定ファイル`jest.config.js`を作成します

```javascript
/** @type {import('ts-jest').JestConfigWithTsJest} */
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/src'],
  testMatch: ['**/*.test.ts'],
  verbose: true,
  transform: {
    '^.+\\.tsx?$': 'ts-jest',
  },
};
```

### 5 package.jsonの設定
`package.json`に以下のスクリプトを追加します

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```

テストを実行するには
```bash
# 全てのテストを1回実行
npm test

# テストを監視モードで実行
npm run test:watch  # 実行後ターミナルをそのままにしておき、ファイルの変更を検知して自動実行
```

**各カスタムスクリプトの役割**
- `build`: TypeScriptのコンパイル
- `test:watch`: テストをウォッチモードで実行

### 6 ディレクトリ構造の作成
```bash
# ディレクトリ構造の作成
mkdir src
mkdir src/repositories
mkdir src/services
mkdir src/controllers
```

この時点のプロジェクト構造
```
form-validation-tdd/
├── node_modules/
├── src/
│   ├── controllers/
│   ├── repositories/
│   └── validators/
├── package.json
├── package-lock.json
├── tsconfig.json
└── jest.config.js
```
