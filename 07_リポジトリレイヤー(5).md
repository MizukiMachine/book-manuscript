## 8. 削除機能の実装

最後に、Todoの削除機能を実装します。まずはテストから始めましょう

```typescript
// src/repositories/todo.repository.test.ts
// 既存のテストコードの下に追加

    describe('delete', () => {
        test('deletes existing todo', async () => {
            // 削除対象のTodoを作成
            const todo = await repository.create({
                title: 'Delete Me'
            });

            // Todoを削除
            await repository.delete(todo.id);

            // 削除したTodoが取得できないことを確認
            const found = await repository.findById(todo.id);
            expect(found).toBeNull();
        });

        test('throws error when todo does not exist', async () => {
            // 存在しないIDでの削除を試みる
            await expect(
                repository.delete('non-existent-id')
            ).rejects.toThrow('Todo not found');
        });

        test('does not affect other todos', async () => {
            // 2つのTodoを作成
            const todo1 = await repository.create({ title: 'Todo 1' });
            const todo2 = await repository.create({ title: 'Todo 2' });

            // todo1を削除
            await repository.delete(todo1.id);

            // todo2は残っていることを確認
            const found = await repository.findById(todo2.id);
            expect(found).toEqual(todo2);
        });
    });
```

テスト結果
```
FAIL  src/repositories/todo.repository.test.ts
  ● TodoRepository › delete › deletes existing todo
    TypeError: repository.delete is not a function
```

削除機能を実装しましょう

```typescript
// src/repositories/todo.repository.ts
export class TodoRepository {
    // 既存のコード...

    async delete(id: string): Promise<void> {
        // 削除対象のTodoが存在するか確認
        const todo = await this.findById(id);
        if (!todo) {
            throw new Error('Todo not found');
        }

        // Todoを削除
        this.todos.delete(id);
    }
}
```

実装のポイント
- 存在チェックを行い、存在しない場合はエラーをスロー
- `Map.delete()`メソッドを使用してTodoを削除
- 戻り値は`void`型で、削除の成功/失敗は例外で表現

テストを再実行します

```bash
npm test
```

実行結果：
```
PASS  src/repositories/todo.repository.test.ts
  TodoRepository
    create
      ✓ creates a new todo with required fields (2ms)
    findById
      ✓ returns todo when exists (1ms)
      ✓ returns null when todo does not exist (1ms)
    findAll
      ✓ returns empty array when no todos exist (1ms)
      ✓ returns all todos (1ms)
    update
      ✓ updates todo fields (1ms)
      ✓ throws error when todo does not exist (1ms)
      ✓ maintains unchanged fields (1ms)
    delete
      ✓ deletes existing todo (1ms)
      ✓ throws error when todo does not exist (1ms)
      ✓ does not affect other todos (1ms)
```

## リポジトリレイヤー実装のまとめ

これでTodoRepositoryの基本的なCRUD操作（Create, Read, Update, Delete）が全て実装できました。
実装したメソッドは

1. `create`: Todoの作成
2. `findById`: IDによるTodoの検索
3. `findAll`: 全Todoの取得
4. `update`: Todoの更新
5. `delete`: Todoの削除

です。

各メソッドについて
- エラー処理を適切に実装
- 非同期処理に対応
- 入力値の検証を実施

## 補足
実際のアプリケーションでは以下のような拡張が予想できます。
チャレンジしてみてください。

1. 機能を追加
   - `findByTitle(title: string)`: タイトルによる検索機能
   - `findCompleted()`: 完了済みTodoの取得
   - `findIncomplete()`: 未完了Todoの取得

2. 更新機能に制約を追加
   - タイトルの最大長制限（例：100文字）
   - 説明文の最大長制限（例：500文字）
   - 完了済みTodoは更新できない


次回からは、このTodoRepositoryを使用するサービスレイヤーの実装に進みます。
