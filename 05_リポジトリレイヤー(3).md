## 5. 検索機能の実装

まずはTodoを検索する機能を追加します。次のテストから始めましょう

```typescript
// src/repositories/todo.repository.test.ts
// 既存のテストコードの下に追加

    describe('findById', () => {
        test('returns todo when exists', async () => {
            // まずテスト用のTodoを作成
            const created = await repository.create({
                title: 'Find Me'
            });

            // 作成したTodoをIDで検索
            const found = await repository.findById(created.id);
            
            // 検索結果が作成したTodoと一致することを確認
            expect(found).toEqual(created);
        });

        test('returns null when todo does not exist', async () => {
            const found = await repository.findById('non-existent-id');
            expect(found).toBeNull();
        });
    });
```

テスト結果
```
FAIL  src/repositories/todo.repository.test.ts
  TodoRepository
    create
      ✓ creates a new todo with required fields (3ms)
    findById
      ✕ returns todo when exists
      ✕ returns null when todo does not exist

  ● TodoRepository › findById › returns todo when exists
    TypeError: repository.findById is not a function
```

期待通り、まだ実装していない`findById`メソッドがないためテストが失敗します。
実装を追加しましょう

```typescript
// src/repositories/todo.repository.ts
export class TodoRepository {
    private todos: Map<string, Todo> = new Map();

    // 既存のcreateメソッド...

    async findById(id: string): Promise<Todo | null> {
        // Mapから指定されたIDのTodoを取得
        // 存在しない場合はnullを返す
        return this.todos.get(id) || null;
    }
}
```

実装のポイント
- `Map.get()`メソッドを使用してTodoを検索
- 見つからない場合は`null`を返す
- `Promise<Todo | null>`で非同期処理と存在しない可能性を表現

テスト結果
```
PASS  src/repositories/todo.repository.test.ts
  TodoRepository
    create
      ✓ creates a new todo with required fields (2ms)
    findById
      ✓ returns todo when exists (1ms)
      ✓ returns null when todo does not exist (1ms)
```

## 6. 全件取得機能の実装

次に、全てのTodoを取得する機能を追加します

```typescript
// src/repositories/todo.repository.test.ts
// 既存のテストコードの下に追加

    describe('findAll', () => {
        test('returns empty array when no todos exist', async () => {
            const todos = await repository.findAll();
            expect(todos).toEqual([]);
        });

        test('returns all todos', async () => {
            // テスト用のTodoを2件作成
            const todo1 = await repository.create({ title: 'Todo 1' });
            const todo2 = await repository.create({ title: 'Todo 2' });

            const todos = await repository.findAll();
            
            // 件数の確認
            expect(todos).toHaveLength(2);
            // 作成したTodoが含まれていることの確認
            expect(todos).toEqual(expect.arrayContaining([todo1, todo2]));
        });
    });
```

テスト結果
```
FAIL  src/repositories/todo.repository.test.ts
  ● TodoRepository › findAll › returns empty array when no todos exist
    TypeError: repository.findAll is not a function
```

`findAll`メソッドを実装しましょう

```typescript
// src/repositories/todo.repository.ts
export class TodoRepository {
    // 既存のコード...

    async findAll(): Promise<Todo[]> {
        // Mapの値（Todo）を配列として返す
        return Array.from(this.todos.values());
    }
}
```

実装のポイント
- `Map.values()`でTodoのイテレータを取得
- `Array.from()`でイテレータを配列に変換

テスト結果
```
PASS  src/repositories/todo.repository.test.ts
  TodoRepository
    create
      ✓ creates a new todo with required fields (2ms)
    findById
      ✓ returns todo when exists (1ms)
      ✓ returns null when todo does not exist (1ms)
    findAll
      ✓ returns empty array when no todos exist (1ms)
      ✓ returns all todos (1ms)
```
